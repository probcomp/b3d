<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>b3d.nvdiffrast.common API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>b3d.nvdiffrast.common</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright (c) 2020, NVIDIA CORPORATION.  All rights reserved.
#
# NVIDIA CORPORATION and its licensors retain all intellectual property
# and proprietary rights in and to this software, related documentation
# and any modifications thereto.  Any use, reproduction, disclosure or
# distribution of this software and related documentation without an express
# license agreement from NVIDIA CORPORATION is strictly prohibited.

from .ops import RasterizeGLContext, _get_plugin, get_log_level, set_log_level

__all__ = [&#34;RasterizeGLContext&#34;, &#34;get_log_level&#34;, &#34;set_log_level&#34;, &#34;_get_plugin&#34;]</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="b3d.nvdiffrast.common.ops" href="ops.html">b3d.nvdiffrast.common.ops</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="b3d.nvdiffrast.common._get_plugin"><code class="name flex">
<span>def <span class="ident">_get_plugin</span></span>(<span>gl=False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def _get_plugin(gl=False):
    assert isinstance(gl, bool)

    # Return cached plugin if already loaded.
    if _cached_plugin.get(gl, None) is not None:
        return _cached_plugin[gl]

    # Make sure we can find the necessary compiler and libary binaries.
    if os.name == &#34;nt&#34;:
        lib_dir = os.path.dirname(__file__) + r&#34;\..\lib&#34;

        def find_cl_path():
            import glob

            for edition in [&#34;Enterprise&#34;, &#34;Professional&#34;, &#34;BuildTools&#34;, &#34;Community&#34;]:
                vs_relative_path = (
                    r&#34;\Microsoft Visual Studio\*\%s\VC\Tools\MSVC\*\bin\Hostx64\x64&#34;
                    % edition
                )
                paths = sorted(
                    glob.glob(r&#34;C:\Program Files&#34; + vs_relative_path), reverse=True
                )
                paths += sorted(
                    glob.glob(r&#34;C:\Program Files (x86)&#34; + vs_relative_path),
                    reverse=True,
                )
                if paths:
                    return paths[0]

        # If cl.exe is not on path, try to find it.
        if os.system(&#34;where cl.exe &gt;nul 2&gt;nul&#34;) != 0:
            cl_path = find_cl_path()
            if cl_path is None:
                raise RuntimeError(
                    &#34;Could not locate a supported Microsoft Visual C++ installation&#34;
                )
            os.environ[&#34;PATH&#34;] += &#34;;&#34; + cl_path

    # Compiler options.
    opts = [&#34;-DNVDR_TORCH&#34;]

    # Linker options for the GL-interfacing plugin.
    ldflags = []
    if gl:
        if os.name == &#34;posix&#34;:
            ldflags = [&#34;-lGL&#34;, &#34;-lEGL&#34;]
        elif os.name == &#34;nt&#34;:
            libs = [&#34;gdi32&#34;, &#34;opengl32&#34;, &#34;user32&#34;, &#34;setgpu&#34;]
            ldflags = [&#34;/LIBPATH:&#34; + lib_dir] + [&#34;/DEFAULTLIB:&#34; + x for x in libs]

    # List of source files.
    if gl:
        source_files = [
            &#34;common.cpp&#34;,
            &#34;glutil.cpp&#34;,
            &#34;rasterize_gl.cpp&#34;,
        ]
    else:
        source_files = [
            &#34;../common/common.cpp&#34;,
            &#34;../common/rasterize.cu&#34;,
            &#34;../common/interpolate.cu&#34;,
            &#34;../common/texture.cu&#34;,
            &#34;../common/texture.cpp&#34;,
            &#34;../common/antialias.cu&#34;,
            &#34;torch_bindings.cpp&#34;,
            &#34;torch_rasterize.cpp&#34;,
            &#34;torch_interpolate.cpp&#34;,
            &#34;torch_texture.cpp&#34;,
            &#34;torch_antialias.cpp&#34;,
        ]

    # Some containers set this to contain old architectures that won&#39;t compile. We only need the one installed in the machine.
    os.environ[&#34;TORCH_CUDA_ARCH_LIST&#34;] = &#34;&#34;

    # On Linux, show a warning if GLEW is being forcibly loaded when compiling the GL plugin.
    if gl and (os.name == &#34;posix&#34;) and (&#34;libGLEW&#34; in os.environ.get(&#34;LD_PRELOAD&#34;, &#34;&#34;)):
        logging.getLogger(&#34;nvdiffrast&#34;).warning(
            &#34;Warning: libGLEW is being loaded via LD_PRELOAD, and will probably conflict with the OpenGL plugin&#34;
        )

    # Try to detect if a stray lock file is left in cache directory and show a warning. This sometimes happens on Windows if the build is interrupted at just the right moment.
    plugin_name = &#34;nvdiffrast_plugin&#34; + (&#34;_gl&#34; if gl else &#34;&#34;)
    try:
        lock_fn = os.path.join(
            torch.utils.cpp_extension._get_build_directory(plugin_name, False), &#34;lock&#34;
        )
        if os.path.exists(lock_fn):
            logging.getLogger(&#34;nvdiffrast&#34;).warning(
                &#34;Lock file exists in build directory: &#39;%s&#39;&#34; % lock_fn
            )
    except Exception:
        pass

    # Speed up compilation on Windows.
    if os.name == &#34;nt&#34;:
        # Skip telemetry sending step in vcvarsall.bat
        os.environ[&#34;VSCMD_SKIP_SENDTELEMETRY&#34;] = &#34;1&#34;

        # Opportunistically patch distutils to cache MSVC environments.
        try:
            import distutils._msvccompiler
            import functools

            if not hasattr(distutils._msvccompiler._get_vc_env, &#34;__wrapped__&#34;):
                distutils._msvccompiler._get_vc_env = functools.lru_cache()(
                    distutils._msvccompiler._get_vc_env
                )
        except Exception:
            pass

    # Compile and load.
    source_paths = [os.path.join(os.path.dirname(__file__), fn) for fn in source_files]
    torch.utils.cpp_extension.load(
        name=plugin_name,
        sources=source_paths,
        extra_cflags=opts,
        extra_cuda_cflags=opts + [&#34;-lineinfo&#34;],
        extra_ldflags=ldflags,
        with_cuda=True,
        verbose=False,
    )

    # Import, cache, and return the compiled module.
    _cached_plugin[gl] = importlib.import_module(plugin_name)
    return _cached_plugin[gl]</code></pre>
</details>
</dd>
<dt id="b3d.nvdiffrast.common.get_log_level"><code class="name flex">
<span>def <span class="ident">get_log_level</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Get current log level.</p>
<h2 id="returns">Returns</h2>
<p>Current log level in nvdiffrast. See <code><a title="b3d.nvdiffrast.common.set_log_level" href="#b3d.nvdiffrast.common.set_log_level">set_log_level()</a></code> for possible values.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_log_level():
    &#34;&#34;&#34;Get current log level.

    Returns:
      Current log level in nvdiffrast. See `set_log_level()` for possible values.
    &#34;&#34;&#34;
    return _get_plugin().get_log_level()</code></pre>
</details>
</dd>
<dt id="b3d.nvdiffrast.common.set_log_level"><code class="name flex">
<span>def <span class="ident">set_log_level</span></span>(<span>level)</span>
</code></dt>
<dd>
<div class="desc"><p>Set log level.</p>
<p>Log levels follow the convention on the C++ side of Torch:
0 = Info,
1 = Warning,
2 = Error,
3 = Fatal.
The default log level is 1.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>level</code></strong></dt>
<dd>New log level as integer. Internal nvdiffrast messages of this
severity or higher will be printed, while messages of lower
severity will be silent.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_log_level(level):
    &#34;&#34;&#34;Set log level.

    Log levels follow the convention on the C++ side of Torch:
      0 = Info,
      1 = Warning,
      2 = Error,
      3 = Fatal.
    The default log level is 1.

    Args:
      level: New log level as integer. Internal nvdiffrast messages of this
             severity or higher will be printed, while messages of lower
             severity will be silent.
    &#34;&#34;&#34;
    _get_plugin().set_log_level(level)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="b3d.nvdiffrast.common.RasterizeGLContext"><code class="flex name class">
<span>class <span class="ident">RasterizeGLContext</span></span>
<span>(</span><span>height, width, output_db=False, mode='automatic', device=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Create a new OpenGL rasterizer context.</p>
<p>Creating an OpenGL context is a slow operation so you should usually reuse the same
context in all calls to <code>rasterize()</code> on the same CPU thread. The OpenGL context
is deleted when the object is destroyed.</p>
<p>Side note: When using the OpenGL context in a rasterization operation, the
context's internal framebuffer object is automatically enlarged to accommodate the
rasterization operation's output shape, but it is never shrunk in size until the
context is destroyed. Thus, if you need to rasterize, say, deep low-resolution
tensors and also shallow high-resolution tensors, you can conserve GPU memory by
creating two separate OpenGL contexts for these tasks. In this scenario, using the
same OpenGL context for both tasks would end up reserving GPU memory for a deep,
high-resolution output tensor.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>output_db</code></strong> :&ensp;<code>bool</code></dt>
<dd>Compute and output image-space derivates of barycentrics.</dd>
<dt><strong><code>mode</code></strong></dt>
<dd>OpenGL context handling mode. Valid values are 'manual' and 'automatic'.</dd>
<dt><strong><code>device</code></strong> :&ensp;<code>Optional</code></dt>
<dd>Cuda device on which the context is created. Type can be
<code>torch.device</code>, string (e.g., <code>'cuda:1'</code>), or int. If not
specified, context will be created on currently active Cuda
device.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>The newly created OpenGL rasterizer context.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class RasterizeGLContext:
    def __init__(self, height, width, output_db=False, mode=&#34;automatic&#34;, device=None):
        &#34;&#34;&#34;Create a new OpenGL rasterizer context.

        Creating an OpenGL context is a slow operation so you should usually reuse the same
        context in all calls to `rasterize()` on the same CPU thread. The OpenGL context
        is deleted when the object is destroyed.

        Side note: When using the OpenGL context in a rasterization operation, the
        context&#39;s internal framebuffer object is automatically enlarged to accommodate the
        rasterization operation&#39;s output shape, but it is never shrunk in size until the
        context is destroyed. Thus, if you need to rasterize, say, deep low-resolution
        tensors and also shallow high-resolution tensors, you can conserve GPU memory by
        creating two separate OpenGL contexts for these tasks. In this scenario, using the
        same OpenGL context for both tasks would end up reserving GPU memory for a deep,
        high-resolution output tensor.

        Args:
          output_db (bool): Compute and output image-space derivates of barycentrics.
          mode: OpenGL context handling mode. Valid values are &#39;manual&#39; and &#39;automatic&#39;.
          device (Optional): Cuda device on which the context is created. Type can be
                             `torch.device`, string (e.g., `&#39;cuda:1&#39;`), or int. If not
                             specified, context will be created on currently active Cuda
                             device.
        Returns:
          The newly created OpenGL rasterizer context.
        &#34;&#34;&#34;
        assert output_db is True or output_db is False
        assert mode in [&#34;automatic&#34;, &#34;manual&#34;]
        self.output_db = output_db
        self.mode = mode
        if device is None:
            cuda_device_idx = torch.cuda.current_device()
        else:
            with torch.cuda.device(device):
                cuda_device_idx = torch.cuda.current_device()
        self.cpp_wrapper = _get_plugin(gl=True).RasterizeGLStateWrapper(
            output_db, mode == &#34;automatic&#34;, cuda_device_idx
        )
        self.active_depth_peeler = None  # For error checking only.

    def set_context(self):
        &#34;&#34;&#34;Set (activate) OpenGL context in the current CPU thread.
        Only available if context was created in manual mode.
        &#34;&#34;&#34;
        assert self.mode == &#34;manual&#34;
        self.cpp_wrapper.set_context()

    def release_context(self):
        &#34;&#34;&#34;Release (deactivate) currently active OpenGL context.
        Only available if context was created in manual mode.
        &#34;&#34;&#34;
        assert self.mode == &#34;manual&#34;
        self.cpp_wrapper.release_context()</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="b3d.nvdiffrast.common.RasterizeGLContext.release_context"><code class="name flex">
<span>def <span class="ident">release_context</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Release (deactivate) currently active OpenGL context.
Only available if context was created in manual mode.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def release_context(self):
    &#34;&#34;&#34;Release (deactivate) currently active OpenGL context.
    Only available if context was created in manual mode.
    &#34;&#34;&#34;
    assert self.mode == &#34;manual&#34;
    self.cpp_wrapper.release_context()</code></pre>
</details>
</dd>
<dt id="b3d.nvdiffrast.common.RasterizeGLContext.set_context"><code class="name flex">
<span>def <span class="ident">set_context</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Set (activate) OpenGL context in the current CPU thread.
Only available if context was created in manual mode.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_context(self):
    &#34;&#34;&#34;Set (activate) OpenGL context in the current CPU thread.
    Only available if context was created in manual mode.
    &#34;&#34;&#34;
    assert self.mode == &#34;manual&#34;
    self.cpp_wrapper.set_context()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="b3d.nvdiffrast" href="../index.html">b3d.nvdiffrast</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="b3d.nvdiffrast.common.ops" href="ops.html">b3d.nvdiffrast.common.ops</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="b3d.nvdiffrast.common._get_plugin" href="#b3d.nvdiffrast.common._get_plugin">_get_plugin</a></code></li>
<li><code><a title="b3d.nvdiffrast.common.get_log_level" href="#b3d.nvdiffrast.common.get_log_level">get_log_level</a></code></li>
<li><code><a title="b3d.nvdiffrast.common.set_log_level" href="#b3d.nvdiffrast.common.set_log_level">set_log_level</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="b3d.nvdiffrast.common.RasterizeGLContext" href="#b3d.nvdiffrast.common.RasterizeGLContext">RasterizeGLContext</a></code></h4>
<ul class="">
<li><code><a title="b3d.nvdiffrast.common.RasterizeGLContext.release_context" href="#b3d.nvdiffrast.common.RasterizeGLContext.release_context">release_context</a></code></li>
<li><code><a title="b3d.nvdiffrast.common.RasterizeGLContext.set_context" href="#b3d.nvdiffrast.common.RasterizeGLContext.set_context">set_context</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>
